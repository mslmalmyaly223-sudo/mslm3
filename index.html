<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø®ØªÙ… Ù…Ù„ÙØ§Øª PDF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        /* ÙƒÙ„ Ø§Ù„Ù€ CSS Ù†ÙØ³Ù‡ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            padding: 0;
            touch-action: pan-y;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        
        header {
            background: var(--gradient);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .logo i {
            font-size: 1.8rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 8px;
        }
        
        .logo-text h1 {
            font-size: 1.4rem;
            margin-bottom: 3px;
        }
        
        .logo-text p {
            opacity: 0.9;
            font-size: 0.8rem;
        }
        
        .main-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f8f9fa;
            -webkit-overflow-scrolling: touch;
            height: calc(100vh - 140px);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
            height: 100%;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            background: var(--gradient);
            padding: 6px;
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border 0.3s;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-height: 44px;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
        }
        
        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary:active {
            background: #3ab8e0;
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(76, 201, 240, 0.3);
        }
        
        .btn-accent {
            background: var(--accent);
            color: white;
        }
        
        .btn-accent:active {
            background: #e11574;
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(247, 37, 133, 0.3);
        }
        
        .btn-telegram {
            background: linear-gradient(135deg, #0088cc 0%, #00aced 100%);
            color: white;
        }
        
        .btn-telegram:active {
            background: #0077b3;
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 136, 204, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .status-area {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .status-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            font-size: 0.95rem;
        }
        
        .status-message {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 80px;
            max-height: 200px;
            overflow-y: auto;
            border-left: 3px solid var(--primary);
            font-size: 0.9rem;
        }
        
        .progress-container {
            margin-top: 12px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.5s;
        }
        
        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 30px 15px;
            text-align: center;
            margin-bottom: 15px;
            transition: border 0.3s;
            cursor: pointer;
        }
        
        .file-upload-area:active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .file-upload-area i {
            font-size: 2.5rem;
            color: #adb5bd;
            margin-bottom: 10px;
        }
        
        .file-upload-area p {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .hidden {
            display: none !important;
        }
        
        .category {
            margin-bottom: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .category-header {
            background: #f8f9fa;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .category-header:active {
            background: #e9ecef;
        }
        
        .category-header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: var(--dark);
        }

        .category.active .category-content {
            max-height: 1000px;
            padding: 10px 15px;
        }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .subject-item {
            padding: 10px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e9ecef;
            min-height: 44px;
        }
        
        .subject-item:active {
            background: #f8f9fa;
            transform: translateX(3px);
        }
        
        .subject-item.selected {
            background: rgba(67, 97, 238, 0.1);
            border-left: 3px solid var(--primary);
        }
        
        .subject-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .subject-checkbox {
            margin-left: 8px;
            transform: scale(1.1);
        }
        
        .sales-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary);
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .reset-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .bottom-nav {
            display: flex;
            background: white;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.1);
            padding: 0;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-top: 3px solid transparent;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item.active {
            border-top: 3px solid var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 3px;
            color: #6c757d;
        }
        
        .nav-item.active i {
            color: var(--primary);
        }
        
        .nav-item span {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #6c757d;
        }
        
        .nav-item.active span {
            color: var(--primary);
        }
        
        .file-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .file-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            min-height: 44px;
        }
        
        .file-list-item:last-child {
            border-bottom: none;
        }
        
        .telegram-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #0088cc 0%, #00aced 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }
        
        .telegram-section h3 {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }
        
        .subject-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .download-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        
        .success-message {
            background: #d1edff;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
        
        @media (max-width: 768px) {
            .sales-stats {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-stamp"></i>
                <div class="logo-text">
                    <h1>Ù†Ø¸Ø§Ù… Ø®ØªÙ… Ù…Ù„ÙØ§Øª PDF</h1>
                    <p>Ø£Ø¶Ù Ø®ØªÙ… Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¥Ù„Ù‰ Ù…Ù„ÙØ§Øª PDF Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
            <div id="sales-section" class="section">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                </h2>
                
                <div class="sales-stats">
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart"></i>
                        <div class="stat-value" id="today-sales">0</div>
                        <div class="stat-label">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                        <button class="reset-btn" id="reset-today">
                            <i class="fas fa-redo"></i> ØªØµÙÙŠØ±
                        </button>
                    </div>
                    
                    <div class="stat-card">
    <i class="fas fa-chart-bar"></i>
    <div class="stat-value" id="total-sales">0</div>
    <div class="stat-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</div>
    <button class="reset-btn" id="reset-total">
        <i class="fas fa-redo"></i> ØªØµÙÙŠØ± Ø§Ù„ÙƒÙ„ÙŠ
    </button>
</div>
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div id="main-section" class="section active">
                <h2 class="section-title">
                    <i class="fas fa-stamp"></i>
                    Ø®ØªÙ… Ø§Ù„Ù…Ù„ÙØ§Øª
                </h2>
                
                <div class="card">
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© <span id="selected-count" class="subject-count">0</span></label>
                        <div class="category active">
                            <div class="category-header">
                                <h3><i class="fas fa-flask"></i> Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ</h3>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="category-content" id="science-subjects">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                            </div>
                        </div>
                        
                        <div class="category">
                            <div class="category-header">
                                <h3><i class="fas fa-book"></i> Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¯Ø¨ÙŠ</h3>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="category-content" id="literary-subjects">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                            </div>
                        </div>
                        
                        <div class="category">
                            <div class="category-header">
                                <h3><i class="fas fa-graduation-cap"></i> Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</h3>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="category-content" id="middle-subjects">
                                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="start-stamp" class="btn btn-secondary">
                            <i class="fas fa-stamp"></i>
                            Ø¨Ø¯Ø¡ Ø§Ù„Ø®ØªÙ…
                        </button>
                    </div>
                </div>
                
                <div id="stamping-section" class="hidden">
                    <div class="status-area">
                        <div class="status-title">
                            <i class="fas fa-sync-alt fa-spin"></i>
                            Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                        </div>
                        <div class="status-message" id="status-message">
                            Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…...
                        </div>
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                                <span id="progress-percent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress" id="progress-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="download-section" class="download-section hidden">
                    <h3>
                        <i class="fas fa-download"></i>
                        ØªÙ… Ø®ØªÙ… Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!
                    </h3>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ØªÙˆÙ…Ø©</p>
                    <div class="action-buttons">
                        <button id="download-all" class="btn btn-primary">
                            <i class="fas fa-download"></i>
                            ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
                        </button>
                        <button id="open-telegram" class="btn btn-telegram">
                            <i class="fab fa-telegram"></i>
                            Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª -->
            <div id="add-files-section" class="section">
                <h2 class="section-title">
                    <i class="fas fa-folder-plus"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
                </h2>
                
                <div class="card">
                    <div class="file-upload-area" id="upload-area">
                        <i class="fas fa-file-pdf"></i>
                        <h3>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„ÙØ§Øª PDF Ù‡Ù†Ø§</h3>
                        <p>Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª</p>
                        <input type="file" id="file-input" accept=".pdf" style="display: none;" multiple>
                    </div>
                    
                    <div id="file-info-section" class="hidden">
                        <div class="form-group">
                            <label for="file-category">Ø§Ù„Ù‚Ø³Ù…</label>
                            <select id="file-category">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
                                <option value="science">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
                                <option value="literary">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¯Ø¨ÙŠ</option>
                                <option value="middle">Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="file-subject">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                            <select id="file-subject">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="file-name">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</label>
                            <input type="text" id="file-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù„Ù„Ù…Ù„Ù">
                        </div>
                        
                        <div class="action-buttons">
                            <button id="add-file" class="btn btn-secondary">
                                <i class="fas fa-plus-circle"></i>
                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="section-title">
                        <i class="fas fa-list"></i>
                        Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
                    </h3>
                    
                    <div class="file-list" id="file-list">
                        <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <div class="bottom-nav">
            <div class="nav-item" data-target="sales-section">
                <i class="fas fa-chart-line"></i>
                <span>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
            </div>
            <div class="nav-item active" data-target="main-section">
                <i class="fas fa-stamp"></i>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </div>
            <div class="nav-item" data-target="add-files-section">
                <i class="fas fa-folder-plus"></i>
                <span>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª</span>
            </div>
        </div>
        
        <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† -->
        <div id="customer-modal" class="modal-overlay hidden">
            <div class="card" style="max-width: 400px; width: 100%;">
                <h3 class="section-title">
                    <i class="fas fa-user"></i>
                    Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†
                </h3>
                <div class="form-group">
                    <label for="customer-id-input">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ØªØ±ØºØ¨ ÙÙŠ Ø®ØªÙ…Ù‡</label>
                    <input type="text" id="customer-id-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†" maxlength="20">
                </div>
                <div class="action-buttons">
                    <button id="confirm-stamp" class="btn btn-primary">
                        <i class="fas fa-stamp"></i>
                        Ø¨Ø¯Ø¡ Ø§Ù„Ø®ØªÙ…
                    </button>
                    <button id="cancel-stamp" class="btn btn-accent">
                        <i class="fas fa-times"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
// ØªÙ‡ÙŠØ¦Ø© Firebase
const firebaseConfig = {
    apiKey: "AIzaSyByZCncrOsQMSkPwP4VcETBgHpRylpZs8o",
    authDomain: "files-b20e5.firebaseapp.com",
    projectId: "files-b20e5",  // ØªØ£ÙƒØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø¨ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø§Ø³Ù… Ù…Ø´Ø±ÙˆØ¹Ùƒ
    storageBucket: "files-b20e5.firebasestorage.app",
    messagingSenderId: "698607784801",
    appId: "1:698607784801:web:a7d6d5e4d7ebef38a5eb20",
    measurementId: "G-KJ67LFWC9G"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


// ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Storage
console.log('ğŸ”¥ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Storage...');

// Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚ÙˆØ§Ø¹Ø¯ Security Ù„Ù„Ù€ Storage (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·)
// ÙÙŠ console.firebase.google.com Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Storage â†’ Rules ÙˆØ§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù€:
/*
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if true;
    }
  }
}
*/

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
console.log('ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase...');

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let originalFiles = [];
        let todaySales = 0;
        let totalSales = 0;
        let stampedFiles = [];
        const FILE_PRICE = 10000;
        const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB Ø­Ø¯ Ø£Ù‚ØµÙ‰

        // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø«Ø§Ø¨ØªØ©
        const fileCategories = {
            science: ["Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø¹Ø±Ø¨ÙŠ", "Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠ", "Ø£Ø­ÙŠØ§Ø¡", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "ÙƒÙŠÙ…ÙŠØ§Ø¡", "ÙÙŠØ²ÙŠØ§Ø¡"],
            literary: ["Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø¹Ø±Ø¨ÙŠ", "Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø§Ù‚ØªØµØ§Ø¯", "ØªØ§Ø±ÙŠØ®", "Ø¬ØºØ±Ø§ÙÙŠØ©"],
            middle: ["Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø¹Ø±Ø¨ÙŠ", "Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠ", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø£Ø­ÙŠØ§Ø¡", "ÙƒÙŠÙ…ÙŠØ§Ø¡", "ÙÙŠØ²ÙŠØ§Ø¡", "Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª"]
        };

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
db.enablePersistence()
  .then(() => console.log('âœ… Firebase ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ'))
  .catch(err => console.log('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:', err));

// Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase
db.collection('test').doc('connection').set({
    timestamp: new Date(),
    status: 'connected'
}).then(() => console.log('âœ… Ø§ØªØµØ§Ù„ Firebase Ù†Ø§Ø¬Ø­'))
.catch(error => console.error('âŒ ÙØ´Ù„ Ø§ØªØµØ§Ù„ Firebase:', error));

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
db.collection('test').doc('connection').set({test: true})
  .then(() => console.log('âœ… Ø§ØªØµØ§Ù„ Firebase ÙŠØ¹Ù…Ù„'))
  .catch(error => console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Firebase:', error));
  
        // === ÙˆØ¸Ø§Ø¦Ù Firebase Firestore ===

// Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
async function saveFilesToFirestore(files) {
    try {
        // Ø­ÙØ¸ ÙÙŠ Firestore ÙÙ‚Ø·
        await db.collection('pdfFiles').doc('filesData').set({
            files: files,
            fileCount: files.length,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Firestore');
        return true;
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª:', error);
        return false;
    }
}

// Ø­ÙØ¸ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ ÙÙŠ Firebase Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
async function saveSingleFileToFirestore(fileData) {
    try {
        const fileId = fileData.id.toString();
        
        await db.collection('pdfFiles').doc(fileId).set({
            ...fileData,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙØ±Ø¯ ÙÙŠ FirebaseØŒ ID:', fileId);
        return true;
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙØ±Ø¯:', error);
        return false;
    }
}

// Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Firestore
async function getFilesFromFirestore() {
    try {
        console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Firestore...');
        
        const snapshot = await db.collection('pdfFiles').get();
        const files = [];
        
        snapshot.forEach(doc => {
            files.push(doc.data());
        });
        
        console.log(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${files.length} Ù…Ù„Ù Ù…Ù† Firestore`);
        return files;
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª:', error);
        return [];
    }
}

        // Ø­ÙØ¸ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙŠ Firestore
        async function saveSalesToFirestore() {
            try {
                await db.collection('sales').doc('salesData').set({
                    todaySales: todaySales,
                    totalSales: totalSales,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙŠ Firestore:', error);
                // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ localStorage
                localStorage.setItem('todaySales', todaySales.toString());
                localStorage.setItem('totalSales', totalSales.toString());
            }
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Firestore
        async function getSalesFromFirestore() {
            try {
                const doc = await db.collection('sales').doc('salesData').get();
                
                if (doc.exists) {
                    const data = doc.data();
                    return {
                        today: data.todaySales || 0,
                        total: data.totalSales || 0
                    };
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙÙŠ FirestoreØŒ Ø¬Ø±Ø¨ localStorage
                    return {
                        today: parseInt(localStorage.getItem('todaySales')) || 0,
                        total: parseInt(localStorage.getItem('totalSales')) || 0
                    };
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Firestore:', error);
                return {
                    today: parseInt(localStorage.getItem('todaySales')) || 0,
                    total: parseInt(localStorage.getItem('totalSales')) || 0
                };
            }
        }

        // === Ù†Ù‡Ø§ÙŠØ© ÙˆØ¸Ø§Ø¦Ù Firebase ===

// Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø³Ù†Ø©)
async function saveFilesToDB(files) {
    try {
        const firestoreSuccess = await saveFilesToFirestore(files);
        if (firestoreSuccess) {
            originalFiles = files; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            return true;
        } else {
            console.log('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Firebase');
            return false;
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª:', error);
        return false;
    }
}

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª (ÙŠØ³ØªØ®Ø¯Ù… Firestore Ù…Ø¹ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)
        async function getFilesFromDB() {
            const files = await getFilesFromFirestore();
            originalFiles = files; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            return files;
        }

        // Ø­ÙØ¸ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function saveSales() {
            saveSalesToFirestore();
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        async function getSalesFromDB() {
            return await getSalesFromFirestore();
        }
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.section');
        const todaySalesEl = document.getElementById('today-sales');
        const totalSalesEl = document.getElementById('total-sales');
        const resetTodayBtn = document.getElementById('reset-today');
        const selectedCountEl = document.getElementById('selected-count');
        
        const categories = document.querySelectorAll('.category');
        const startStampBtn = document.getElementById('start-stamp');
        const stampingSection = document.getElementById('stamping-section');
        const statusMessage = document.getElementById('status-message');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const downloadSection = document.getElementById('download-section');
        const downloadAllBtn = document.getElementById('download-all');
        const openTelegramBtn = document.getElementById('open-telegram');
        
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const fileInfoSection = document.getElementById('file-info-section');
        const fileCategorySelect = document.getElementById('file-category');
        const fileSubjectSelect = document.getElementById('file-subject');
        const fileNameInput = document.getElementById('file-name');
        const addFileBtn = document.getElementById('add-file');
        const fileListEl = document.getElementById('file-list');
        
        const customerModal = document.getElementById('customer-modal');
        const customerIdInput = document.getElementById('customer-id-input');
        const confirmStampBtn = document.getElementById('confirm-stamp');
        const cancelStampBtn = document.getElementById('cancel-stamp');

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const target = this.getAttribute('data-target');
                
                navItems.forEach(nav => nav.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(target).classList.add('active');
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª
                if (target === 'add-files-section') {
                    updateFileList();
                }
            });
        });
        
        // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        categories.forEach(category => {
            const header = category.querySelector('.category-header');
            const content = category.querySelector('.category-content');
            const icon = header.querySelector('.fa-chevron-down');
            
            header.addEventListener('click', function() {
                const isActive = category.classList.contains('active');
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
                categories.forEach(cat => {
                    if (cat !== category) {
                        cat.classList.remove('active');
                        cat.querySelector('.fa-chevron-down').classList.remove('fa-rotate-180');
                    }
                });
                
                // ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                if (isActive) {
                    category.classList.remove('active');
                    icon.classList.remove('fa-rotate-180');
                } else {
                    category.classList.add('active');
                    icon.classList.add('fa-rotate-180');
                }
            });
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±
        fileCategorySelect.addEventListener('change', function() {
            const category = this.value;
            fileSubjectSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>';
            
            if (category && fileCategories[category]) {
                fileCategories[category].forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    fileSubjectSelect.appendChild(option);
                });
            }
        });
        
        // Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#4361ee';
            uploadArea.style.background = 'rgba(67, 97, 238, 0.05)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#dee2e6';
            uploadArea.style.background = 'white';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#dee2e6';
            uploadArea.style.background = 'white';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
function handleFileUpload(file) {
    if (!file) {
        showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù!');
        return;
    }
    
    if (file.type !== 'application/pdf') {
        showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF ÙÙ‚Ø·!');
        return;
    }
    
    if (file.size > MAX_FILE_SIZE) {
        showError(`Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‡Ùˆ ${MAX_FILE_SIZE / 1024 / 1024}MB`);
        return;
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
    fileInfoSection.classList.remove('hidden');
    
    // ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    fileNameInput.value = file.name.replace('.pdf', '');
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    showSuccess(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø­Ø¬Ù…: ${formatFileSize(file.size)}`);
}
        
function readFileAsBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            // Ø¥Ø±Ø¬Ø§Ø¹ base64 ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† data URL prefix
            const base64 = e.target.result.split(',')[1];
            resolve(base64);
        };
        reader.onerror = (e) => {
            reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
        };
        reader.onabort = (e) => {
            reject(new Error('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
        };
        reader.readAsDataURL(file);
    });
}
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
addFileBtn.addEventListener('click', async function() {
    const category = fileCategorySelect.value;
    const subject = fileSubjectSelect.value;
    const fileName = fileNameInput.value.trim();
    const file = fileInput.files[0];
    
    console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù:', file?.name, 'Ø§Ù„Ø­Ø¬Ù…:', file?.size);
    
    if (!category || !subject || !fileName) {
        showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
        return;
    }
    
    if (!file) {
        showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹!');
        return;
    }
    
    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (10MB Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ù€ IndexedDB)
    if (file.size > 10 * 1024 * 1024) {
        showError('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 10MB');
        return;
    }
    
    addFileBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
    addFileBtn.disabled = true;

    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
    const progressHTML = `
        <div id="file-progress" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0; text-align: center;">
            <div style="font-size: 14px; color: #4361ee; margin-bottom: 8px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù„Ù...</div>
            <div class="progress-bar" style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                <div id="file-progress-bar" style="height: 100%; background: #4361ee; width: 0%; transition: width 0.3s;"></div>
            </div>
            <div id="file-progress-text" style="font-size: 12px; color: #6c757d; margin-top: 5px;">0%</div>
        </div>
    `;
    
    fileInfoSection.insertAdjacentHTML('beforeend', progressHTML);
    const progressBar = document.getElementById('file-progress-bar');
    const progressText = document.getElementById('file-progress-text');

    try {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
        progressBar.style.width = '30%';
        progressText.textContent = '30% - Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...';
        
        console.log('ğŸ“– Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...');
        
        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ ArrayBuffer (Ø£ÙØ¶Ù„ Ù…Ù† base64)
        const fileBuffer = await readFileAsArrayBuffer(file);
        console.log('âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØŒ Ø§Ù„Ø­Ø¬Ù…:', fileBuffer.byteLength);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
        progressBar.style.width = '60%';
        progressText.textContent = '60% - Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ù…Ø­Ù„ÙŠØ§Ù‹...';
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ IndexedDB
        const fileId = Date.now();
        await saveFileToIndexedDB(fileId, fileBuffer);
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù ÙÙŠ IndexedDB');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
        progressBar.style.width = '80%';
        progressText.textContent = '80% - Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase...';
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© ÙÙ‚Ø· ÙÙŠ Firebase (Ø¨Ø¯ÙˆÙ† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù)
        const fileData = {
            id: fileId,
            name: fileName,
            category: category,
            subject: subject,
            uploadDate: new Date().toLocaleDateString('ar-EG'),
            fileSize: formatFileSize(file.size),
            originalFileName: file.name,
            lastModified: new Date().toISOString(),
            // Ù„Ø§ Ù†Ø­ÙØ¸ fileContent Ù‡Ù†Ø§
            storedIn: 'indexedDB' //æ ‡è®°å­˜å‚¨åœ¨IndexedDBä¸­
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© ÙÙŠ Firebase
        await db.collection('pdfFiles').doc(fileId.toString()).set(fileData);
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ© ÙÙŠ Firebase');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        progressBar.style.width = '100%';
        progressText.textContent = '100% - ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!';
        
        // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        originalFiles.push(fileData);
        
        // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙ‚Ø¯Ù…
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
        document.getElementById('file-progress').remove();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        updateFileList();
        updateSubjectsList();
        
        showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        fileInfoSection.classList.add('hidden');
        fileCategorySelect.value = '';
        fileSubjectSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>';
        fileNameInput.value = '';
        fileInput.value = '';
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:', error);
        
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        const progressElement = document.getElementById('file-progress');
        if (progressElement) progressElement.remove();
        
        showError(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù: ${error.message}`);
    } finally {
        addFileBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù';
        addFileBtn.disabled = false;
    }
});
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
        function updateFileList() {
            fileListEl.innerHTML = '';
            
            if (originalFiles.length === 0) {
                fileListEl.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯</p>';
                return;
            }
            
            originalFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-list-item';
                fileItem.innerHTML = `
                    <div>
                        <div class="file-name">${file.name}.pdf</div>
                        <div style="color: #6c757d; font-size: 0.9rem;">${file.subject} - ${getCategoryName(file.category)} - ${file.fileSize}</div>
                    </div>
                    <div class="file-actions">
                        <button class="delete-btn" data-id="${file.id}" style="background: var(--accent); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>
                    </div>
                `;
                fileListEl.appendChild(fileItem);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const fileId = this.getAttribute('data-id');
                    deleteFile(fileId);
                });
            });
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
        function getCategoryName(category) {
            const names = {
                science: 'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ',
                literary: 'Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¯Ø¨ÙŠ', 
                middle: 'Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·'
            };
            return names[category] || category;
        }
        
        // Ø­Ø°Ù Ù…Ù„Ù
        async function deleteFile(fileId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ')) {
                originalFiles = originalFiles.filter(f => f.id != fileId);
                await saveFilesToDB(originalFiles);
                updateFileList();
                updateSubjectsList();
                showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        function updateSubjectsList() {
            const scienceContainer = document.getElementById('science-subjects');
            const literaryContainer = document.getElementById('literary-subjects');
            const middleContainer = document.getElementById('middle-subjects');
            
            scienceContainer.innerHTML = '';
            literaryContainer.innerHTML = '';
            middleContainer.innerHTML = '';
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù…
            const scienceFiles = originalFiles.filter(f => f.category === 'science');
            const literaryFiles = originalFiles.filter(f => f.category === 'literary');
            const middleFiles = originalFiles.filter(f => f.category === 'middle');
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø¹Ù„Ù…ÙŠ
            fileCategories.science.forEach(subject => {
                const hasFile = scienceFiles.some(f => f.subject === subject);
                addSubjectItem(scienceContainer, subject, hasFile, 'science');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯Ø¨ÙŠ
            fileCategories.literary.forEach(subject => {
                const hasFile = literaryFiles.some(f => f.subject === subject);
                addSubjectItem(literaryContainer, subject, hasFile, 'literary');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·
            fileCategories.middle.forEach(subject => {
                const hasFile = middleFiles.some(f => f.subject === subject);
                addSubjectItem(middleContainer, subject, hasFile, 'middle');
            });
            
            updateSelectedCount();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù…Ø§Ø¯Ø©
        function addSubjectItem(container, subject, hasFile, category) {
            const subjectItem = document.createElement('div');
            subjectItem.className = `subject-item ${hasFile ? '' : 'disabled'}`;
            subjectItem.innerHTML = `
                <input type="checkbox" class="subject-checkbox" id="${category}-${subject}" 
                       data-file="${subject}.pdf" data-category="${category}" 
                       ${hasFile ? '' : 'disabled'}>
                <label for="${category}-${subject}">${subject} ${hasFile ? '' : '(ØºÙŠØ± Ù…ØªÙˆÙØ±)'}</label>
            `;
            container.appendChild(subjectItem);
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ¯
            const checkbox = subjectItem.querySelector('.subject-checkbox');
            if (hasFile) {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        this.closest('.subject-item').classList.add('selected');
                    } else {
                        this.closest('.subject-item').classList.remove('selected');
                    }
                    updateSelectedCount();
                });
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('.subject-checkbox:checked').length;
            selectedCountEl.textContent = selectedCount;
        }
        
        // ØªØµÙÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        resetTodayBtn.addEventListener('click', function() {
            if (todaySales > 0) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ')) {
                    todaySales = 0;
                    updateSalesDisplay();
                    saveSales();
                    showSuccess('ØªÙ… ØªØµÙÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…!');
                }
            } else {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù„ÙŠÙˆÙ…!');
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        function updateSalesDisplay() {
            todaySalesEl.textContent = todaySales.toLocaleString();
            totalSalesEl.textContent = totalSales.toLocaleString();
        }
        
        // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…
        startStampBtn.addEventListener('click', function() {
            const selectedFiles = getSelectedFiles();
            
            if (selectedFiles.length === 0) {
                showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†
            customerModal.classList.remove('hidden');
            customerIdInput.value = '';
            customerIdInput.focus();
        });
        
        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®ØªÙ…
        confirmStampBtn.addEventListener('click', async function() {
            const customerId = customerIdInput.value.trim();
            
            if (!customerId) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†!');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†
            if (!/^[0-9]+$/.test(customerId)) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø²Ø¨ÙˆÙ† ØµØ­ÙŠØ­ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)');
                return;
            }
            
            customerModal.classList.add('hidden');
            
            const selectedFiles = getSelectedFiles();
            await startStampingProcess(selectedFiles, customerId);
        });
        
        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø®ØªÙ…
        cancelStampBtn.addEventListener('click', function() {
            customerModal.classList.add('hidden');
        });
        
        // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…
        async function startStampingProcess(files, customerId) {
            stampingSection.classList.remove('hidden');
            downloadSection.classList.add('hidden');
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…...', 'info');
            updateProgress(0);
            
            try {
                stampedFiles = await stampFiles(files, customerId);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„
                downloadSection.classList.remove('hidden');
                updateStatus('ØªÙ… Ø®ØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Stamping error:', error);
                updateStatus(`Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø®ØªÙ…: ${error.message}`, 'error');
                showError(`ÙØ´Ù„ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…: ${error.message}`);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        downloadAllBtn.addEventListener('click', function() {
            downloadStampedFiles();
        });
        
        // ÙØªØ­ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        openTelegramBtn.addEventListener('click', function() {
            openTelegramWithFiles(stampedFiles);
        });
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function getSelectedFiles() {
            const selected = [];
            document.querySelectorAll('.subject-checkbox:checked').forEach(checkbox => {
                const subjectName = checkbox.nextElementSibling.textContent.replace(' (ØºÙŠØ± Ù…ØªÙˆÙØ±)', '').trim();
                const category = checkbox.dataset.category;
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                const fileData = originalFiles.find(f => 
                    f.subject === subjectName && f.category === category
                );
                
                if (fileData) {
                    selected.push(fileData);
                }
            });
            return selected;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
        function updateStatus(message, type = 'info') {
            let icon = 'â„¹ï¸';
            let color = '#3498db';
            
            if (type === 'error') {
                icon = 'âŒ';
                color = '#e74c3c';
            } else if (type === 'success') {
                icon = 'âœ…';
                color = '#2ecc71';
            }
            
            statusMessage.innerHTML = `${icon} ${message}`;
            statusMessage.style.borderLeft = `3px solid ${color}`;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${Math.round(percent)}%`;
        }
        
        // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®ØªÙ…
        async function stampFiles(files, customerId) {
            const totalFiles = files.length;
            const stamped = [];
            
            for (let i = 0; i < totalFiles; i++) {
                const currentFile = files[i];
                updateStatus(`Ø¬Ø§Ø±ÙŠ Ø®ØªÙ… Ù…Ù„Ù: ${currentFile.subject} (${i+1}/${totalFiles})<br>Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†: ${customerId}`, 'info');
                updateProgress(((i) / totalFiles) * 100);
                
                try {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù…Ø®ØªÙˆÙ…
                    const stampedFile = await createStampedPDF(currentFile, customerId);
                    stamped.push(stampedFile);
                    
                    updateProgress(((i + 1) / totalFiles) * 100);
                    
                    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error('Error stamping file:', error);
                    throw new Error(`ÙØ´Ù„ ÙÙŠ Ø®ØªÙ… Ù…Ù„Ù ${currentFile.subject}: ${error.message}`);
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            const totalAmount = files.length * FILE_PRICE;
            todaySales += totalAmount;
            totalSales += totalAmount;
            updateSalesDisplay();
            saveSales();
            
            return stamped;
        }
        
async function createStampedPDF(file, customerId) {
    try {
        console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø®ØªÙ… Ù…Ù„Ù:', file.name);
        
        // Ø¬Ù„Ø¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ù…Ù† IndexedDB
        console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ù† IndexedDB...');
        const fileBuffer = await getFileFromIndexedDB(file.id);
        
        const { PDFDocument, rgb } = PDFLib;
        
        console.log('ğŸ“„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ PDF...');
        const pdfDoc = await PDFDocument.load(fileBuffer);
        const pages = pdfDoc.getPages();
        
        console.log(`ğŸ“‘ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${pages.length}`);
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª Ù„Ù„Ø®ØªÙ…
        const pagesToStamp = new Set();
        if (pages.length > 1) pagesToStamp.add(1);
        if (pages.length > 2) pagesToStamp.add(2);
        if (pages.length > 1) pagesToStamp.add(pages.length - 2);
        if (pages.length > 0) pagesToStamp.add(pages.length - 1);
        
        console.log('ğŸ“ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø®ØªÙˆÙ…Ø©:', Array.from(pagesToStamp).map(p => p + 1));
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØªÙ…
        pagesToStamp.forEach(pageIndex => {
            const page = pages[pageIndex];
            const { width, height } = page.getSize();
            
            page.drawText(`${customerId}`, {
                x: width - 100,
                y: height - 40,
                size: 12,
                color: rgb(0.5, 0.5, 0.5),
                opacity: 0.8
            });
        });
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªÙˆÙ…
        const stampedPdfBytes = await pdfDoc.save();
        const stampedBlob = new Blob([stampedPdfBytes], { type: 'application/pdf' });
        const stampedUrl = URL.createObjectURL(stampedBlob);
        
        console.log('âœ… ØªÙ… Ø§Ù„Ø®ØªÙ… Ø¨Ù†Ø¬Ø§Ø­');
        
        return {
            name: `Ù…Ø±Ø´Ø­Ø§Øª_${file.subject}.pdf`,
            subject: file.subject,
            customerId: customerId,
            timestamp: new Date().toLocaleString('ar-EG'),
            downloadUrl: stampedUrl,
            blob: stampedBlob,
            pageCount: pages.length
        };
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®ØªÙ…:', error);
        throw new Error('ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù PDF: ' + error.message);
    }
}
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø®ØªÙˆÙ…Ø©
        function downloadStampedFiles() {
            if (stampedFiles.length === 0) {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø®ØªÙˆÙ…Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„');
                return;
            }
            
            // ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ù…Ù„Ù Ø¹Ù„Ù‰ Ø­Ø¯Ø©
            stampedFiles.forEach((file, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = file.downloadUrl;
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    setTimeout(() => URL.revokeObjectURL(file.downloadUrl), 1000);
                }, index * 1000);
            });
            
            showSuccess(`Ø³ÙŠØ¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ ${stampedFiles.length} Ù…Ù„Ù...`);
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        async function openTelegramWithFiles(files) {
            if (files.length === 0) {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø®ØªÙˆÙ…Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„');
                return;
            }

            const BOT_TOKEN = '8412491014:AAGdDQUzyr76zAOh-zBFcC0Ckydo4cXhW5w';
            const CHAT_ID = '7627801499';
            
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…...', 'info');
            openTelegramBtn.disabled = true;
            openTelegramBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

            try {
                let successCount = 0;
                let errorCount = 0;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    updateStatus(`Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù: ${file.subject} (${i+1}/${files.length})`, 'info');

                    try {
                        const pdfFile = new File([file.blob], file.name, { type: 'application/pdf' });

                        const formData = new FormData();
                        formData.append('chat_id', CHAT_ID);
                        formData.append('document', pdfFile);
                        formData.append('caption', `ğŸ“ ${file.subject}\nğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†: ${file.customerId}`);

                        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (result.ok) {
                            successCount++;
                            updateStatus(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„: ${file.subject} (${i+1}/${files.length})`, 'success');
                        } else {
                            errorCount++;
                            updateStatus(`âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„: ${file.subject}`, 'error');
                        }

                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                    } catch (fileError) {
                        errorCount++;
                        console.error(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ ${file.name}:`, fileError);
                        updateStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ: ${file.subject}`, 'error');
                    }
                }

                const message = `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${successCount} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­${errorCount > 0 ? ` Ùˆ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ ${errorCount} Ù…Ù„Ù` : ''}`;
                updateStatus(message, errorCount > 0 ? 'error' : 'success');
                showSuccess(message);

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
                updateStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${error.message}`, 'error');
                showError(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${error.message}`);
            } finally {
                openTelegramBtn.disabled = false;
                openTelegramBtn.innerHTML = '<i class="fab fa-telegram"></i> Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…';
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
        function showError(message) {
            alert(`âŒ ${message}`);
        }
        
        function showSuccess(message) {
            alert(`âœ… ${message}`);
        }
   
// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©
function checkLoadedFiles() {
    console.log('=== ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© ===');
    console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª:', originalFiles.length);
    originalFiles.forEach((file, index) => {
        console.log(`Ø§Ù„Ù…Ù„Ù ${index + 1}:`, {
            name: file.name,
            subject: file.subject,
            category: file.category,
            hasContent: !!file.fileContent,
            contentSize: file.fileContent?.length || 0
        });
    });
    console.log('=== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ ===');
}
 
 // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª IndexedDB
function openIDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('PDFFilesDB', 1);
        
        request.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'));
        request.onsuccess = () => resolve(request.result);
        
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('files')) {
                db.createObjectStore('files', { keyPath: 'id' });
            }
        };
    });
}

// Ø­ÙØ¸ Ù…Ù„Ù ÙÙŠ IndexedDB
async function saveFileToIndexedDB(fileId, fileBuffer) {
    const db = await openIDB();
    return new Promise((resolve, reject) => {
        const transaction = db.transaction(['files'], 'readwrite');
        const store = transaction.objectStore('files');
        
        const request = store.put({
            id: fileId,
            content: fileBuffer,
            timestamp: new Date()
        });
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù'));
    });
}

// Ø¬Ù„Ø¨ Ù…Ù„Ù Ù…Ù† IndexedDB
async function getFileFromIndexedDB(fileId) {
    const db = await openIDB();
    return new Promise((resolve, reject) => {
        const transaction = db.transaction(['files'], 'readonly');
        const store = transaction.objectStore('files');
        
        const request = store.get(fileId);
        request.onsuccess = () => {
            if (request.result) {
                resolve(request.result.content);
            } else {
                reject(new Error('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'));
            }
        };
        request.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù'));
    });
}

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ ArrayBuffer
function readFileAsArrayBuffer(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = () => reject(new Error('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
        reader.readAsArrayBuffer(file);
    });
}

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
document.addEventListener('DOMContentLoaded', async function() {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
    try {
        const sales = await getSalesFromFirestore();
        todaySales = sales.today;
        totalSales = sales.total;
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª');
    } catch (error) {
        console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:', error);
        todaySales = 0;
        totalSales = 0;
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
    try {
        console.log('ğŸ“ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Firebase...');
        originalFiles = await getFilesFromFirestore();
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${originalFiles.length} Ù…Ù„Ù Ù…Ù† Firebase`);
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©
        checkLoadedFiles();
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª:', error);
        originalFiles = [];
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    updateSalesDisplay();
    updateSubjectsList();
    updateFileList();
    
    console.log('ğŸ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!');
});

        // Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØµÙŠ
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
