<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سوق الطلاب</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #f8f9fa;
            --accent-color: #ff6b6b;
            --text-color: #333;
            --light-text: #6c757d;
            --border-color: #dee2e6;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
        }
        
        .container {
            max-width: 100%;
            padding: 0;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white;
        }
        
        /* صفحة الدخول */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #4a6bff, #6a11cb);
        }
        
        .auth-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .auth-box h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .auth-tab {
            flex: 1;
            padding: 10px;
            cursor: pointer;
            font-weight: 500;
            color: var(--light-text);
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: right;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            background-color: #3a5bef;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-color);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        /* الصفحة الرئيسية */
        .header {
            position: sticky;
            top: 0;
            background-color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
        }
        
        .header h1 {
            font-size: 18px;
            color: var(--primary-color);
            margin: 0;
        }
        
        .header .btn {
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .posts-container {
            padding: 15px;
            padding-bottom: 70px;
        }
        
        .post {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        .post.pinned {
            border-left: 4px solid var(--primary-color);
            background-color: #f8f9ff;
        }
        
        .post.verified {
            border-left: 4px solid var(--success-color);
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .post-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--primary-color);
        }
        
        .post-price {
            font-weight: bold;
            color: var(--success-color);
        }
        
        .post-description {
            margin-bottom: 15px;
            color: var(--text-color);
            line-height: 1.5;
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .post-actions .btn {
            width: 48%;
            padding: 8px;
            font-size: 14px;
        }
        
        .admin-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .admin-actions .btn {
            width: 23%;
            padding: 5px;
            font-size: 12px;
        }
        
        /* نافذة إنشاء منشور */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            animation: modalOpen 0.3s;
        }
        
        @keyframes modalOpen {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h2 {
            font-size: 18px;
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .select-group {
            margin-bottom: 15px;
        }
        
        .select-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .select-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-footer .btn {
            width: auto;
            margin-left: 10px;
        }
        
        /* صفحة الحساب */
        .profile-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .profile-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-email {
            color: var(--light-text);
            font-size: 14px;
        }
        
        .edit-icon {
            margin-right: 5px;
            color: var(--primary-color);
            cursor: pointer;
        }
        
        .profile-menu {
            padding: 15px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: var(--secondary-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item:hover {
            background-color: #e9ecef;
            transform: translateX(-5px);
        }
        
        .menu-item i {
            margin-left: 10px;
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .menu-item span {
            font-weight: 500;
        }
        
        /* الشريط السفلي */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light-text);
            text-decoration: none;
            font-size: 12px;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-item i {
            font-size: 20px;
            margin-bottom: 3px;
        }
        
        /* التنبيهات */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 300;
            animation: slideIn 0.3s, slideOut 0.3s 2.7s forwards;
            display: none;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* صفحة الإبلاغات */
        .report-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .report-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        
        .report-actions .btn {
            width: auto;
            margin-left: 10px;
            padding: 8px 15px;
        }
        
        /* التعليقات */
        .comments-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }
        
        .comment {
            padding: 10px;
            margin-bottom: 10px;
            background-color: var(--secondary-color);
            border-radius: 5px;
            position: relative;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            color: var(--light-text);
        }
        
        .comment-content {
            font-size: 14px;
        }
        
        .comment-form {
            display: flex;
            margin-top: 15px;
        }
        
        .comment-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px 0 0 5px;
            border-left: none;
        }
        
        .comment-submit {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        
        /* فلتر البحث */
        .filter-container {
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
        }
        
        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- صفحة المصادقة -->
    <div id="auth-page" class="auth-container">
        <div class="auth-box">
            <h1>سوق الطلاب</h1>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">تسجيل الدخول</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">إنشاء حساب</div>
            </div>
            
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-email">البريد الإلكتروني</label>
                    <input type="email" id="login-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">كلمة المرور</label>
                    <input type="password" id="login-password" class="form-control" required>
                </div>
                <button type="button" class="btn" onclick="login()">تسجيل الدخول</button>
            </form>
            
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-name">الاسم الكامل</label>
                    <input type="text" id="register-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="register-email">البريد الإلكتروني</label>
                    <input type="email" id="register-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="register-password">كلمة المرور</label>
                    <input type="password" id="register-password" class="form-control" required>
                </div>
                <button type="button" class="btn" onclick="register()">إنشاء حساب</button>
            </form>
        </div>
    </div>
    
    <!-- الصفحة الرئيسية -->
    <div id="main-page" class="container" style="display: none;">
        <div class="header">
            <button class="btn" onclick="openCreatePostModal()"><i class="fas fa-plus"></i> إنشاء منشور</button>
            <h1>سوق الطلاب</h1>
        </div>
        
        <div class="filter-container">
            <select class="filter-select" onchange="filterPosts(this.value)">
                <option value="">كل المواد</option>
                <option value="اسلامية">اسلامية</option>
                <option value="عربي">عربي</option>
                <option value="انكليزي">انكليزي</option>
                <option value="رياضيات">رياضيات</option>
                <option value="احياء">احياء</option>
                <option value="كيمياء">كيمياء</option>
                <option value="فيزياء">فيزياء</option>
                <option value="اجتماعيات">اجتماعيات</option>
                <option value="تاريخ">تاريخ</option>
                <option value="جغرافية">جغرافية</option>
                <option value="اقتصاد">اقتصاد</option>
                <option value="علوم">علوم</option>
            </select>
        </div>
        
        <div class="posts-container" id="posts-container">
            <!-- المنشورات سيتم إضافتها هنا عبر JavaScript -->
        </div>
        
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showMainPage()">
                <i class="fas fa-home"></i>
                <span>الرئيسية</span>
            </div>
            <div class="nav-item" onclick="showProfilePage()">
                <i class="fas fa-user"></i>
                <span>حسابي</span>
            </div>
        </div>
    </div>
    
    
    <!-- صفحة التعليقات -->
    <div id="comments-page" class="container" style="display: none;">
        <div class="header">
            <button class="btn btn-secondary" onclick="backToMainFromComments()"><i class="fas fa-arrow-right"></i></button>
            <h1>التعليقات</h1>
        </div>
        <div class="posts-container">
            <div id="comments-list-page"></div>
            <div style="display:flex; margin-top:10px;">
                <input type="text" id="comment-text" class="form-control" placeholder="أضف تعليقًا...">
                <button class="btn" style="width:auto;" onclick="addCommentFromPage()">إرسال</button>
            </div>
        </div>
    </div>
    <!-- صفحة الحساب -->
    <div id="profile-page" class="container" style="display: none;">
        <div class="profile-header">
            <div class="profile-name">
                <span id="profile-name">محمد علي</span>
                <i class="fas fa-pencil-alt edit-icon" onclick="editProfileName()"></i>
            </div>
            <div class="profile-email" id="profile-email">user@example.com</div>
        </div>
        
        <div class="profile-menu">
            <div class="menu-item" onclick="showUserPosts()">
                <i class="fas fa-book"></i>
                <span>منشوراتي</span>
            </div>
            <div class="menu-item" onclick="showReports()">
                <i class="fas fa-flag"></i>
                <span>البلاغات الواردة</span>
            </div>
            <div class="menu-item" onclick="window.open('https://t.me/MSLM_ALMYALY', '_blank')">
                <i class="fas fa-thumbtack"></i>
                <span>تثبيت المنشور بـ 1$</span>
            </div>
            <div class="menu-item" onclick="openTelegramChannel()">
                <i class="fab fa-telegram"></i>
                <span>قناة التلكرام</span>
            </div>
            <div class="menu-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>تسجيل الخروج</span>
            </div>
        </div>
        
        <div class="bottom-nav">
            <div class="nav-item" onclick="showMainPage()">
                <i class="fas fa-home"></i>
                <span>الرئيسية</span>
            </div>
            <div class="nav-item active">
                <i class="fas fa-user"></i>
                <span>حسابي</span>
            </div>
        </div>
    </div>
    
    <!-- صفحة منشورات المستخدم -->
    <div id="user-posts-page" class="container" style="display: none;">
        <div class="header">
            <button class="btn btn-secondary" onclick="backToProfile()"><i class="fas fa-arrow-right"></i></button>
            <h1>منشوراتي</h1>
        </div>
        
        <div class="posts-container" id="user-posts-container">
            <!-- منشورات المستخدم سيتم إضافتها هنا عبر JavaScript -->
        </div>
    </div>
    
    <!-- صفحة البلاغات -->
    <div id="reports-page" class="container" style="display: none;">
        <div class="header">
            <button class="btn btn-secondary" onclick="backToProfile()"><i class="fas fa-arrow-right"></i></button>
            <h1>البلاغات الواردة</h1>
        </div>
        
        <div class="posts-container" id="reports-container">
            <!-- البلاغات سيتم إضافتها هنا عبر JavaScript -->
        </div>
    </div>
    
    <!-- صفحة خدمة التثبيت -->
    <div id="pin-service-page" class="container" style="display: none;">
        <div class="header">
            <button class="btn btn-secondary" onclick="backToProfile()"><i class="fas fa-arrow-right"></i></button>
            <h1>تثبيت المنشور</h1>
        </div>
        
        <div class="posts-container">
            <div class="post">
                <p>لتثبيت منشورك أعلى قسم المنشورات لمدة يوم كامل بمبلغ 1$ يرجى مراسلة هذا الحساب في التلكرام:</p>
                <p style="text-align: center; font-weight: bold; margin: 15px 0;">@MSLM_ALMYALY</p>
            </div>
        </div>
    </div>
    
    <!-- نافذة إنشاء منشور -->
    <div id="create-post-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إنشاء منشور جديد</h2>
                <button class="close-modal" onclick="closeCreatePostModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="post-subject">المادة والصف</label>
                <input type="text" id="post-subject" class="form-control" placeholder="مثال: رياضيات - سادس علمي" required>
            </div>
            
            <div class="form-group">
                <label for="post-price">السعر (دينار عراقي)</label>
                <input type="number" id="post-price" class="form-control" placeholder="مثال: 5000" required>
            </div>
            
            <div class="select-group">
                <label for="post-material">المادة</label>
                <select id="post-material" class="select-control">
                    <option value="اسلامية">اسلامية</option>
                    <option value="عربي">عربي</option>
                    <option value="انكليزي">انكليزي</option>
                    <option value="رياضيات">رياضيات</option>
                    <option value="احياء">احياء</option>
                    <option value="كيمياء">كيمياء</option>
                    <option value="فيزياء">فيزياء</option>
                    <option value="اجتماعيات">اجتماعيات</option>
                    <option value="تاريخ">تاريخ</option>
                    <option value="جغرافية">جغرافية</option>
                    <option value="اقتصاد">اقتصاد</option>
                    <option value="علوم">علوم</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="post-description">وصف الملزمة</label>
                <textarea id="post-description" class="form-control" rows="4" placeholder="اسم الأستاذ، وصف الملزمة، وغيرها من التفاصيل" required></textarea>
            </div>
            
            <div class="select-group">
                <label for="contact-method">طريقة التواصل</label>
                <select id="contact-method" class="select-control" onchange="changeContactMethod()">
                    <option value="whatsapp">واتساب</option>
                    <option value="telegram">تلكرام</option>
                    <option value="comments">تعليقات</option>
                </select>
            </div>
            
            <div class="form-group" id="whatsapp-field">
                <label for="whatsapp-number">رقم الواتساب</label>
                <input type="text" id="whatsapp-number" class="form-control" placeholder="9641234567890">
            </div>
            
            <div class="form-group" id="telegram-field" style="display: none;">
                <label for="telegram-username">اسم المستخدم في التلكرام</label>
                <input type="text" id="telegram-username" class="form-control" placeholder="@MSLM_ALMYALY">
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreatePostModal()">إلغاء</button>
                <button class="btn" onclick="createPost()">نشر</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة تفاصيل المنشور -->
    <div id="post-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="post-details-title">تفاصيل المنشور</h2>
                <button class="close-modal" onclick="closePostDetailsModal()">&times;</button>
            </div>
            
            <div class="post-description" id="post-full-description"></div>
            
            <div id="post-comments" class="comments-container"></div>
            <div id="post-contact-info" style="margin: 15px 0; padding: 10px; background-color: #f8f9fa; border-radius: 5px; display: none;">
                <h4 style="margin-bottom: 10px;">طريقة التواصل:</h4>
                <p id="contact-details"></p>
            </div>
            
            
            
            <div class="modal-footer">
                <button id="report-btn" class="btn btn-danger" onclick="reportPost()">إبلاغ</button>
            </div>
        </div>
    </div>
    
    <!-- نافذة تعديل الاسم -->
    <div id="edit-name-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تعديل الاسم</h2>
                <button class="close-modal" onclick="closeEditNameModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="new-name">الاسم الجديد</label>
                <input type="text" id="new-name" class="form-control" required>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditNameModal()">إلغاء</button>
                <button class="btn" onclick="saveProfileName()">حفظ</button>
            </div>
        </div>
    </div>
    
    <!-- تنبيه -->
    <div id="notification" class="notification" style="display: none;"></div>
    
    <script>
        // بيانات التطبيق
        const currentUser = {
            name: "",
            email: "",
            isAdmin: false
        }
        function saveData(){
            localStorage.setItem('posts', JSON.stringify(posts));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('reports', JSON.stringify(reports));
        }
        function getCssVar(name){
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }
;
        
        let posts = JSON.parse(localStorage.getItem('posts')||'[]');
        if(!Array.isArray(posts)) posts=[];
        let users = JSON.parse(localStorage.getItem('users')||'[]');
        if(!Array.isArray(users)) users=[];
        let reports = JSON.parse(localStorage.getItem('reports')||'[]');
        if(!Array.isArray(reports)) reports=[];
        
        // عناصر DOM
        const authPage = document.getElementById("auth-page");
        const mainPage = document.getElementById("main-page");
        const profilePage = document.getElementById("profile-page");
        const userPostsPage = document.getElementById("user-posts-page");
        const reportsPage = document.getElementById("reports-page");
        const pinServicePage = document.getElementById("pin-service-page");
        const postsContainer = document.getElementById("posts-container");
        const userPostsContainer = document.getElementById("user-posts-container");
        const reportsContainer = document.getElementById("reports-container");
        const commentsPage = document.getElementById("comments-page");
        
        // تهيئة التطبيق
        document.addEventListener("DOMContentLoaded", function() {
            const loggedInUser = localStorage.getItem("loggedInUser");
            if (loggedInUser) { 
                const user = JSON.parse(loggedInUser);
                loginUser(user);
            }
            const seeded = localStorage.getItem('seeded')==='1';
            if (!seeded && users.length===0 && posts.length===0) { 
                addSampleData(); 
                saveData(); 
                localStorage.setItem('seeded','1'); 
            }
            renderPosts();
            if (typeof renderReports === 'function') renderReports();
        });
        // إضافة بيانات وهمية للاختبار
        function addSampleData() {
            users.push({
                name: "محمد علي",
                email: "mslmalmyaly223@gmail.com",
                password: "admin123",
                isAdmin: true
            });
            
            users.push({
                name: "أحمد حسن",
                email: "ahmed@example.com",
                password: "test123"
            });
            
            posts.push({
                id: 1,
                userId: "mslmalmyaly223@gmail.com",
                userName: "محمد علي",
                subject: "رياضيات - سادس علمي",
                material: "رياضيات",
                price: "5000",
                description: "ملزمة الأستاذ علي حسين تحتوي على جميع الدروس مع تمارين وحلول. المنهج كامل مع ملخصات للامتحانات.",
                contactMethod: "whatsapp",
                whatsapp: "964781234567",
                createdAt: new Date(),
                isPinned: true,
                isVerified: true
            });
            
            posts.push({
                id: 2,
                userId: "ahmed@example.com",
                userName: "أحمد حسن",
                subject: "كيمياء - خامس علمي",
                material: "كيمياء",
                price: "4000",
                description: "ملزمة كيمياء شاملة لجميع الفصول مع تجارب عملية وحلول للأسئلة الوزارية.",
                contactMethod: "telegram",
                telegram: "@AhmedChem",
                createdAt: new Date(Date.now() - 86400000),
                comments: [
                    {
                        userId: "mslmalmyaly223@gmail.com",
                        userName: "محمد علي",
                        text: "هل الملزمة تشمل الأسئلة الوزارية لسنوات سابقة؟",
                        createdAt: new Date(Date.now() - 43200000)
                    },
                    {
                        userId: "ahmed@example.com",
                        userName: "أحمد حسن",
                        text: "نعم تشمل آخر 5 سنوات مع حلولها",
                        createdAt: new Date(Date.now() - 43100000)
                    }
                ]
            });
            
            reports.push({
                id: 1,
                postId: 2,
                reporterEmail: "mslmalmyaly223@gmail.com",
                reason: "معلومات غير صحيحة",
                status: "pending",
                createdAt: new Date()
            });
        }
        
        // تبديل بين تسجيل الدخول وإنشاء حساب
        function switchAuthTab(tab) {
            document.querySelectorAll(".auth-tab").forEach(t => t.classList.remove("active"));
            document.querySelectorAll(".auth-form").forEach(f => f.classList.remove("active"));
            
            if (tab === "login") {
                document.querySelector(".auth-tab:nth-child(1)").classList.add("active");
                document.getElementById("login-form").classList.add("active");
            } else {
                document.querySelector(".auth-tab:nth-child(2)").classList.add("active");
                document.getElementById("register-form").classList.add("active");
            }
        }
        
        // تسجيل الدخول
        function login() {
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            
            if (!email || !password) {
                showNotification("يرجى ملء جميع الحقول", "error");
                return;
            }
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                loginUser(user);
                showNotification("تم تسجيل الدخول بنجاح", "success");
            } else {
                showNotification("البريد الإلكتروني أو كلمة المرور غير صحيحة", "error");
            }
        }
        
        // تسجيل الدخول للمستخدم
        function loginUser(user) {
            currentUser.name = user.name;
            currentUser.email = user.email;
            currentUser.isAdmin = user.isAdmin || false;
            
            // حفظ حالة تسجيل الدخول
            localStorage.setItem("loggedInUser", JSON.stringify({
                name: user.name,
                email: user.email,
                isAdmin: user.isAdmin || false
            }));
            
            // تحديث واجهة المستخدم
            authPage.style.display = "none";
            mainPage.style.display = "block";
            document.getElementById("profile-name").textContent = user.name;
            if (user.isAdmin) {
                document.getElementById("profile-email").textContent = user.email;
            } else {
                document.getElementById("profile-email").style.display = "none";
            }
            
            // عرض المنشورات
            renderPosts();
        }
        
        // إنشاء حساب جديد
        function register() {
            const name = document.getElementById("register-name").value;
            const email = document.getElementById("register-email").value;
            const password = document.getElementById("register-password").value;
            
            if (!name || !email || !password) {
                showNotification("يرجى ملء جميع الحقول", "error");
                return;
            }
            
            // تحقق من صحة البريد الإلكتروني
            if (!validateEmail(email)) {
                showNotification("البريد الإلكتروني غير صالح", "error");
                return;
            }
            
            // تحقق إذا كان البريد الإلكتروني مستخدم بالفعل
            if (users.some(u => u.email === email)) {
                showNotification("البريد الإلكتروني مستخدم بالفعل", "error");
                return;
            }
            
            // إضافة المستخدم الجديد
            const newUser = {
                name,
                email,
                password
            };
            
            users.push(newUser);
            saveData();
            loginUser(newUser);
            showNotification("تم إنشاء الحساب بنجاح", "success");
            
            // الانتقال إلى تسجيل الدخول
            switchAuthTab("login");
            document.getElementById("login-email").value = email;
            document.getElementById("login-password").value = password;
        }
        
        // تحقق من صحة البريد الإلكتروني
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // تسجيل الخروج
        function logout() {
            localStorage.removeItem("loggedInUser");
            currentUser.name = "";
            currentUser.email = "";
            currentUser.isAdmin = false;
            
            authPage.style.display = "flex";
            mainPage.style.display = "none";
            profilePage.style.display = "none";
            
            // إعادة تعيين النماذج
            document.getElementById("login-email").value = "";
            document.getElementById("login-password").value = "";
            document.getElementById("register-name").value = "";
            document.getElementById("register-email").value = "";
            document.getElementById("register-password").value = "";
            
            switchAuthTab("login");
        }
        
        // عرض الصفحة الرئيسية
        function showMainPage() {
            mainPage.style.display = "block";
            profilePage.style.display = "none";
            userPostsPage.style.display = "none";
            reportsPage.style.display = "none";
            pinServicePage.style.display = "none";
            
            // تحديث القائمة السفلية
            document.querySelectorAll(".nav-item").forEach(item => item.classList.remove("active"));
            document.querySelectorAll(".nav-item")[0].classList.add("active");
            
            renderPosts();
        }
        
        // عرض صفحة الحساب
        function showProfilePage() {
            mainPage.style.display = "none";
            profilePage.style.display = "block";
            userPostsPage.style.display = "none";
            reportsPage.style.display = "none";
            pinServicePage.style.display = "none";
            
            // تحديث القائمة السفلية
            document.querySelectorAll(".nav-item").forEach(item => item.classList.remove("active"));
            document.querySelectorAll(".nav-item")[1].classList.add("active");
        }
        
        // عرض منشورات المستخدم
        function showUserPosts() {
            profilePage.style.display = "none";
            userPostsPage.style.display = "block";
            
            renderUserPosts();
        }
        
        // عرض البلاغات
        function showReports() {
            profilePage.style.display = "none";
            
            if (currentUser.isAdmin) {
                reportsPage.style.display = "block";
                renderReports();
            } else {
                // للمستخدمين العاديين، عرض البلاغات التي أرسلوها فقط
                const userReports = reports.filter(r => r.reporterEmail === currentUser.email);
                
                if (userReports.length > 0) {
                    reportsPage.style.display = "block";
                    renderReports();
                } else {
                    showNotification("ليس لديك أي بلاغات سابقة", "info");
                }
            }
        }
        
        // عرض صفحة خدمة التثبيت
        function showPinService() {
            profilePage.style.display = "none";
            pinServicePage.style.display = "block";
        }
        
        // العودة إلى صفحة الحساب
        function backToProfile() {
            userPostsPage.style.display = "none";
            reportsPage.style.display = "none";
            pinServicePage.style.display = "none";
            profilePage.style.display = "block";
        }
        
        // فتح قناة التلكرام
        function openTelegramChannel() {
            window.open("https://t.me/IbnalKufa", "_blank");
        }
        
        // عرض المنشورات
        function renderPosts(filterMaterial = "") {
            postsContainer.innerHTML = "";
            
            // فرز المنشورات حسب التثبيت ثم التاريخ
            const sortedPosts = [...posts].sort((a, b) => {
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            // تصفية حسب المادة إذا تم تحديدها
            const filteredPosts = filterMaterial ? 
                sortedPosts.filter(post => post.material === filterMaterial) : 
                sortedPosts;
            
            if (filteredPosts.length === 0) {
                postsContainer.innerHTML = '<div class="post"><p>لا توجد منشورات متاحة</p></div>';
                return;
            }
            
            filteredPosts.forEach(post => {
                const postElement = document.createElement("div");
                postElement.className = `post ${post.isPinned ? 'pinned' : ''} ${post.isVerified ? 'verified' : ''}`;
                
                let adminActions = "";
                if (currentUser.isAdmin && currentUser.email === "mslmalmyaly223@gmail.com") {
                    adminActions = `
                        <div class="admin-actions">
                            <button class="btn btn-danger" onclick="deletePost(${post.id})"><i class="fas fa-trash"></i></button>
                            <button class="btn ${post.isVerified ? 'btn-success' : 'btn-secondary'}" onclick="toggleVerifyPost(${post.id})">
                                <i class="fas ${post.isVerified ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                            </button>
                            <button class="btn ${post.isPinned ? 'btn-warning' : 'btn-secondary'}" onclick="togglePinPost(${post.id})">
                                <i class="fas fa-thumbtack"></i>
                            </button>
                            <button class="btn btn-danger" onclick="toggleBanUser(\'${post.userId}\')">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    `;
                }
                
                postElement.innerHTML = `
                    ${adminActions}
                    <div class="post-header">
                        <div class="post-user" style="font-weight:bold; color:#333; margin-bottom:5px;">${post.userName}</div>
                        <div class="post-title" style="font-size:14px; color:#555;">${post.subject}</div>
                        <div class="post-price">${post.price} دينار</div>
                    </div>
                    <div class="post-description">${post.description}</div>
                    <div class="post-actions">
                        <button class="btn btn-secondary" onclick="viewPostDetails(${post.id})">تفاصيل</button>
                        ${
                            post.contactMethod === "whatsapp"
                            ? `<a class="btn" href="https://wa.me/${post.whatsapp}" target="_blank">واتساب</a>`
                            : post.contactMethod === "telegram"
                                ? `<a class="btn" href="https://t.me/${post.telegram.replace('@', '')}" target="_blank">تلكرام</a>`
                                : `<button class="btn" onclick="openCommentsPage(${post.id})">تعليقات</button>`
                        }
                    </div>
                    <div id="comments-section-${post.id}" class="comments-section" style="display:none; margin-top:10px; border-top:1px solid #ccc; padding-top:10px;">
                        <div id="comments-list-${post.id}"></div>
                        <div style="display:flex; margin-top:10px;">
                            <input type="text" id="comment-input-${post.id}" class="form-control" placeholder="أضف تعليقًا...">
                            <button class="btn" style="width:auto;" onclick="addComment(${post.id})">إرسال</button>
                        </div>
                    </div>
                `;
                
                postsContainer.appendChild(postElement);
            });
        }
        
        // عرض منشورات المستخدم
        function renderUserPosts() {
            userPostsContainer.innerHTML = "";
            
            const userPosts = posts.filter(post => post.userId === currentUser.email);
            
            if (userPosts.length === 0) {
                userPostsContainer.innerHTML = '<div class="post"><p>ليس لديك أي منشورات</p></div>';
                return;
            }
            
            userPosts.forEach(post => {
                const postElement = document.createElement("div");
                postElement.className = `post ${post.isPinned ? 'pinned' : ''} ${post.isVerified ? 'verified' : ''}`;
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-user" style="font-weight:bold; color:#333; margin-bottom:5px;">${post.userName}</div>
                        <div class="post-title" style="font-size:14px; color:#555;">${post.subject}</div>
                        <div class="post-price">${post.price} دينار</div>
                    </div>
                    <div class="post-description">${post.description}</div>
                    <div class="post-actions">
                        <button class="btn btn-secondary" onclick="viewPostDetails(${post.id})">تفاصيل</button>
                        ${post.contactMethod === "comments" ? "" : `<button class="btn" onclick="showPostContact(${post.id})">التواصل</button>`}
                    </div>
                `;
                
                userPostsContainer.appendChild(postElement);
            });
        }
        
        // عرض البلاغات
        function renderReports() {
            reportsContainer.innerHTML = "";
            
            let reportsToShow = [];
            
            if (currentUser.isAdmin) {
                reportsToShow = [...reports];
            } else {
                reportsToShow = reports.filter(r => r.reporterEmail === currentUser.email);
            }
            
            if (reportsToShow.length === 0) {
                reportsContainer.innerHTML = '<div class="post"><p>لا توجد بلاغات</p></div>';
                return;
            }
            
            reportsToShow.forEach(report => {
                const post = posts.find(p => p.id === report.postId);
                if (!post) return;
                
                const reportElement = document.createElement("div");
                reportElement.className = "report-item";
                
                let adminActions = "";
                if (currentUser.isAdmin) {
                    adminActions = `
                        <div class="report-actions">
                            <button class="btn btn-danger" onclick="banUser('${post.userId}')">حظر المستخدم</button>
                            <button class="btn btn-secondary" onclick="dismissReport(${report.id})">رفض البلاغ</button>
                        </div>
                    `;
                }
                
                reportElement.innerHTML = `
                    <div class="report-header">
                        <div><strong>المنشور:</strong> ${post.subject}</div>
                        <div>${new Date(report.createdAt).toLocaleString()}</div>
                    </div>
                    <div><strong>سبب البلاغ:</strong> ${report.reason}</div>
                    <div><strong>الحالة:</strong> ${report.status === "pending" ? "قيد المراجعة" : "تمت معالجته"}</div>
                    ${adminActions}
                `;
                
                reportsContainer.appendChild(reportElement);
            });
        }
        
        // فتح نافذة إنشاء منشور
        function openCreatePostModal() {
            document.getElementById("create-post-modal").style.display = "block";
        }
        
        // إغلاق نافذة إنشاء منشور
        function closeCreatePostModal() {
            document.getElementById("create-post-modal").style.display = "none";
        }
        
        // تغيير طريقة العرض حسب طريقة التواصل المختارة
        function changeContactMethod() {
            const method = document.getElementById("contact-method").value;
            
            document.getElementById("whatsapp-field").style.display = method === "whatsapp" ? "block" : "none";
            document.getElementById("telegram-field").style.display = method === "telegram" ? "block" : "none";
        }
        
        // إنشاء منشور جديد
        function createPost() {
            const subject = document.getElementById("post-subject").value;
            const price = document.getElementById("post-price").value;
            const material = document.getElementById("post-material").value;
            const description = document.getElementById("post-description").value;
            const contactMethod = document.getElementById("contact-method").value;
            
            if (!subject || !price || !description) {
                showNotification("يرجى ملء جميع الحقول المطلوبة", "error");
                return;
            }
            
            let contactInfo = {};
            
            if (contactMethod === "whatsapp") {
                const whatsapp = document.getElementById("whatsapp-number").value;
                if (!whatsapp) {
                    showNotification("يرجى إدخال رقم الواتساب", "error");
                    return;
                }
                contactInfo.whatsapp = whatsapp;
            } else if (contactMethod === "telegram") {
                const telegram = document.getElementById("telegram-username").value;
                if (!telegram) {
                    showNotification("يرجى إدخال اسم مستخدم التلكرام", "error");
                    return;
                }
                contactInfo.telegram = telegram;
            }
            
            const newPost = {
                id: posts.length > 0 ? Math.max(...posts.map(p => p.id)) + 1 : 1,
                userId: currentUser.email,
                userName: currentUser.name,
                subject,
                material,
                price,
                description,
                contactMethod,
                ...contactInfo,
                createdAt: new Date(),
                comments: []
            };
            
            posts.unshift(newPost);
            saveData();
            closeCreatePostModal();
            renderPosts();
            showNotification("تم نشر المنشور بنجاح", "success");
            
            // إرسال إشعار للمالك إذا كان مسؤولاً
            if (currentUser.email !== "mslmalmyaly223@gmail.com") {
                sendAdminNotification("تم نشر منشور جديد بواسطة " + currentUser.name);
            }
        }
        
        // عرض تفاصيل المنشور
        function viewPostDetails(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            document.getElementById("post-details-title").textContent = post.subject;
            document.getElementById("post-full-description").textContent = post.description;
            
            // عرض التعليقات
            const commentsContainer = document.getElementById("post-comments");
            commentsContainer.innerHTML = "";
            
            if (post.comments && post.comments.length > 0) {
                post.comments.forEach(comment => {
                    const commentElement = document.createElement("div");
                    commentElement.className = "comment";
                    
                    commentElement.innerHTML = `
                        <div class="comment-header">
                            <span>${comment.userName}</span>
                            <span>${new Date(comment.createdAt).toLocaleString()}</span>
                        </div>
                        <div class="comment-content">${comment.text}</div>
                    `;
                    
                    // إضافة زر الحظر للمالك أو صاحب المنشور
                    if (currentUser.isAdmin || currentUser.email === post.userId) {
                        const banButton = document.createElement("button");
                        banButton.className = "btn btn-danger";
                        banButton.style.marginTop = "5px";
                        banButton.style.fontSize = "10px";
                        banButton.style.padding = "3px 5px";
                        banButton.innerHTML = '<i class="fas fa-ban"></i> حظر';
                        banButton.onclick = (e) => {
                            e.stopPropagation();
                            banCommenter(comment.userId);
                        };
                        
                        commentElement.appendChild(banButton);
                    }
                    
                    commentsContainer.appendChild(commentElement);
                });
            } else {
                commentsContainer.innerHTML = '<p>لا توجد تعليقات بعد</p>';
            }
            
            document.getElementById("post-details-modal").style.display = "block";
            document.getElementById("post-contact-info").style.display = "none";
            document.getElementById("comment-text").value = "";
            document.getElementById("comment-text").focus();
            
            // حفظ معرف المنشور الحالي في الزر
            document.getElementById('show-contact-btn').setAttribute('data-post-id', postId);
            document.getElementById('report-btn').setAttribute('data-post-id', postId);
            }
        
        // إغلاق نافذة تفاصيل المنشور
        function closePostDetailsModal() {
            document.getElementById("post-details-modal").style.display = "none";
        }
        
        // عرض معلومات التواصل للمنشور
        function showPostContact(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            if (post.contactMethod === "comments") {
                viewPostDetails(postId);
                return;
            }
            
            let contactInfo = "";
            
            if (post.contactMethod === "whatsapp") {
                contactInfo = `واتساب: <a href="https://wa.me/${post.whatsapp}">${post.whatsapp}</a>`;
            } else if (post.contactMethod === "telegram") {
                contactInfo = `تلكرام: <a href="https://t.me/${post.telegram.replace('@', '')}">${post.telegram}</a>`;
            }
            
            document.getElementById("contact-details").innerHTML = contactInfo;
            document.getElementById("post-contact-info").style.display = "block";
            
            // إرسال إشعار لصاحب المنشور
            sendNotification(post.userId, "شخص مهتم بمنشورك: " + post.subject);
        }
        
        
        // إضافة تعليق
        function addComment() {
            const postId = parseInt(document.querySelector("#post-details-modal .btn").getAttribute("data-post-id"));
            const commentText = document.getElementById("comment-text").value.trim();
            
            if (!commentText) {
                showNotification("يرجى إدخال نص التعليق", "error");
                return;
            }
            
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            if (!post.comments) {
                post.comments = [];
            }
            
            const newComment = {
                userId: currentUser.email,
                userName: currentUser.name,
                text: commentText,
                createdAt: new Date()
            };
            
            post.comments.unshift(newComment);
            saveData();
            document.getElementById("comment-text").value = "";
            viewPostDetails(postId);
            
            // إرسال إشعار لصاحب المنشور
            if (post.userId !== currentUser.email) {
                sendNotification(post.userId, "تم إضافة تعليق على منشورك: " + post.subject);
            }
        }
        
        // حظر معلق
        function banCommenter(userId) {
            // في تطبيق حقيقي، هنا سيتم حظر المستخدم في قاعدة البيانات
            showNotification("تم حظر المستخدم بنجاح", "success");
        }
        
        // الإبلاغ عن منشور
        function reportPost() {
            const postId = parseInt(document.getElementById('report-btn').getAttribute('data-post-id'));
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            // في تطبيق حقيقي، هنا ستكون هناك نافذة لإدخال سبب الإبلاغ
            const newReport = {
                id: reports.length > 0 ? Math.max(...reports.map(r => r.id)) + 1 : 1,
                postId,
                reporterEmail: currentUser.email,
                reason: "محتوى غير لائق", // يمكن جعل هذا حقل إدخال
                status: "pending",
                createdAt: new Date()
            };
            
            reports.push(newReport);
            saveData();
            closePostDetailsModal();
            showNotification("تم إرسال البلاغ بنجاح", "success");
            
            // إرسال إشعار للمالك
            sendAdminNotification("تم الإبلاغ عن منشور بواسطة " + currentUser.name);
        }
        
        // رفض البلاغ (للمسؤول)
        function dismissReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (report) {
                report.status = "dismissed";
                renderReports();
                showNotification("تم رفض البلاغ", "success");
            }
        }
        
        // حظر مستخدم (للمسؤول)
        function banUser(userEmail) {
            // في تطبيق حقيقي، هنا سيتم حظر المستخدم في قاعدة البيانات
            showNotification("تم حظر المستخدم بنجاح", "success");
            
            // تحديث حالة البلاغات المرتبطة بهذا المستخدم
            const userPosts = posts.filter(p => p.userId === userEmail);
            userPosts.forEach(post => {
                const postReports = reports.filter(r => r.postId === post.id);
                postReports.forEach(report => {
                    report.status = "resolved";
                });
            });
            
            renderReports();
        }
        
        // حذف منشور (للمسؤول)
        function deletePost(postId) {
            const index = posts.findIndex(p => p.id === postId);
            if (index !== -1) {
                posts.splice(index, 1);
                saveData();
                renderPosts();
                showNotification("تم حذف المنشور بنجاح", "success");
            }
        }
        
        // تبديل حالة توثيق المنشور (للمسؤول)
        function toggleVerifyPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.isVerified = !post.isVerified;
                saveData();
                renderPosts();
                showNotification(`تم ${post.isVerified ? 'توثيق' : 'إلغاء توثيق'} المنشور`, "success");
            }
        }
        
        // تبديل حالة تثبيت المنشور (للمسؤول)
        function togglePinPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.isPinned = !post.isPinned;
                saveData();
                renderPosts();
                showNotification(`تم ${post.isPinned ? 'تثبيت' : 'إلغاء تثبيت'} المنشور`, "success");
            }
        }
        

        // تبديل حالة حظر المستخدم (للمسؤول)
        function toggleBanUser(userEmail) {
            const user = users.find(u => u.email === userEmail);
            if (!user) return;
            user.isBanned = !user.isBanned;
            saveData();
            renderPosts();
            showNotification(`تم ${user.isBanned ? 'حظر' : 'إلغاء حظر'} المستخدم`, "success");
        }

        
        // إظهار / إخفاء التعليقات أسفل المنشور
        function toggleComments(postId) {
            const section = document.getElementById(`comments-section-${postId}`);
            if (section.style.display === "none") {
                renderComments(postId);
                section.style.display = "block";
            } else {
                section.style.display = "none";
            }
        }

        // عرض التعليقات لمنشور معين
        function renderComments(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            const list = document.getElementById(`comments-list-${postId}`);
            list.innerHTML = "";
            if (post.comments && post.comments.length > 0) {
                post.comments.forEach(comment => {
                    const div = document.createElement("div");
                    div.className = "comment";
                    div.style.background = "#f8f9fa";
                    div.style.padding = "5px";
                    div.style.marginBottom = "5px";
                    div.innerHTML = `<b>${comment.userName}:</b> ${comment.text}`;
                    list.appendChild(div);
                });
            } else {
                list.innerHTML = "<p>لا توجد تعليقات بعد</p>";
            }
        }

        // إضافة تعليق
        function addComment(postId) {
            const input = document.getElementById(`comment-input-${postId}`);
            const text = input.value.trim();
            if (!text) {
                showNotification("يرجى إدخال نص التعليق", "error");
                return;
            }
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            if (!post.comments) post.comments = [];
            const newComment = {
                userId: currentUser.email,
                userName: currentUser.name,
                text: text,
                createdAt: new Date()
            };
            post.comments.unshift(newComment);
            saveData();
            input.value = "";
            renderComments(postId);
        }

        // تصفية المنشورات حسب المادة
        function filterPosts(material) {
            renderPosts(material);
        }
        
        
        // فتح صفحة التعليقات
        function openCommentsPage(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            mainPage.style.display = "none";
            commentsPage.style.display = "block";
            commentsPage.setAttribute("data-post-id", postId);
            renderCommentsPage(postId);
        }

        // رجوع من صفحة التعليقات
        function backToMainFromComments() {
            commentsPage.style.display = "none";
            mainPage.style.display = "block";
        }

        // عرض التعليقات في صفحة منفصلة
        function renderCommentsPage(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            const list = document.getElementById("comments-list-page");
            list.innerHTML = "";
            if (post.comments && post.comments.length > 0) {
                post.comments.forEach(comment => {
                    const div = document.createElement("div");
                    div.className = "comment";
                    div.innerHTML = `<b>${comment.userName}:</b> ${comment.text}`;
                    
                    // زر الحظر يظهر فقط لصاحب المنشور
                    if (currentUser.email === post.userId) {
                        const banBtn = document.createElement("button");
                        banBtn.className = "btn btn-danger";
                        banBtn.style.margin = "5px";
                        banBtn.style.fontSize = "10px";
                        banBtn.textContent = "حظر";
                        banBtn.onclick = () => {
                            banCommenter(comment.userId);
                        };
                        div.appendChild(banBtn);
                    }
                    list.appendChild(div);
                });
            } else {
                list.innerHTML = "<p>لا توجد تعليقات بعد</p>";
            }
        }

        // اضافة تعليق من صفحة التعليقات
        function addCommentFromPage() {
            const postId = parseInt(commentsPage.getAttribute("data-post-id"));
            const input = document.getElementById("comment-text");
            const text = input.value.trim();
            if (!text) {
                showNotification("يرجى إدخال نص التعليق", "error");
                return;
            }
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            if (!post.comments) post.comments = [];
            const newComment = {
                userId: currentUser.email,
                userName: currentUser.name,
                text: text,
                createdAt: new Date()
            };
            post.comments.unshift(newComment);
            saveData();
            input.value = "";
            renderCommentsPage(postId);
        }
    
        // تعديل اسم المستخدم
        function editProfileName() {
            document.getElementById("new-name").value = currentUser.name;
            document.getElementById("edit-name-modal").style.display = "block";
        }
        
        // إغلاق نافذة تعديل الاسم
        function closeEditNameModal() {
            document.getElementById("edit-name-modal").style.display = "none";
        }
        
        // حفظ الاسم الجديد
        function saveProfileName() {
            const newName = document.getElementById("new-name").value.trim();
            
            if (!newName) {
                showNotification("يرجى إدخال اسم صحيح", "error");
                return;
            }
            
            currentUser.name = newName;
            document.getElementById("profile-name").textContent = newName;
            
            // تحديث الاسم في البيانات المحلية
            const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
            if (loggedInUser) {
                loggedInUser.name = newName;
                localStorage.setItem("loggedInUser", JSON.stringify(loggedInUser));
            }
            
            // تحديث الاسم في المنشورات
            posts.forEach(post => {
                if (post.userId === currentUser.email) {
                    post.userName = newName;
                }
                
                if (post.comments) {
                    post.comments.forEach(comment => {
                        if (comment.userId === currentUser.email) {
                            comment.userName = newName;
                        }
                    });
                }
            });
            
            closeEditNameModal();
            showNotification("تم تحديث الاسم بنجاح", "success");
        }
        
        // إرسال إشعار للمسؤول
        function sendAdminNotification(message) {
            // في تطبيق حقيقي، هنا سيتم إرسال الإشعار إلى المسؤول
            console.log("إشعار للمسؤول:", message);
        }
        
        // إرسال إشعار للمستخدم
        function sendNotification(userEmail, message) {
            // في تطبيق حقيقي، هنا سيتم إرسال الإشعار إلى المستخدم
            console.log(`إشعار إلى ${userEmail}:`, message);
        }
        
        // عرض تنبيه
        function showNotification(message, type = "success") {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.style.display = "block";
            
            // تحديد لون التنبيه حسب النوع
            if (type === "error") {
                notification.style.backgroundColor = getCssVar('--danger-color');
            } else if (type === "warning") {
                notification.style.backgroundColor = getCssVar('--warning-color');
            } else if (type === "info") {
                notification.style.backgroundColor = getCssVar('--primary-color');
            } else {
                notification.style.backgroundColor = getCssVar('--success-color');
            }
            
            // إخفاء التنبيه بعد 3 ثواني
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }
        
        // إرسال إشعار يومي (محاكاة)
        function sendDailyNotification() {
            const now = new Date();
            const hours = now.getHours();
            
            // إرسال الإشعار عند الساعة 9 صباحًا
            if (hours === 9) {
                showNotification("تم تحميل ملازم جديدة بأسعار رخيصة! تصفح الآن.", "info");
            }
        }
        
        // محاكاة الإشعار اليومي (لأغراض الاختبار)
        setInterval(sendDailyNotification, 3600000); // كل ساعة للاختبار
    </script>
</body>
</html>